<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>메뉴 관리자</title>
  <style>
    table, th, td { border: 1px solid #aaa; border-collapse: collapse; padding: 6px; }
    th { background: #f0f0f0; }
    input[type="text"], input[type="number"] { width: 100px; }
  </style>
</head>
<body>
  <h2>🛠️ 메뉴 관리자</h2>
  <table id="menuTable">
    <thead>
      <tr>
        <th>id</th>
        <th>이름</th>
        <th>가격</th>
        <th>활성화</th>
        <th>삭제</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addRow()">➕ 새 메뉴 추가</button>
  <button onclick="saveMenus()">💾 저장</button>
  <p id="result" style="margin-top:1em;"></p>

  <script>
    const apiBase = "https://script.google.com/macros/s/AKfycbxXTTSmXC7SuPVU90q72mgjifhzjrSj1j0ggCupkwsVs4NLOka8p16by7YYBrNaK6Jwug/exec";

    function createRow(menu = { id: "", name: "", price: "", active: true }) {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td><input type="text" value="${menu.id}" /></td>
        <td><input type="text" value="${menu.name}" /></td>
        <td><input type="number" value="${menu.price}" /></td>
        <td><input type="checkbox" ${menu.active === true || menu.active === "true" ? "checked" : ""} /></td>
        <td><button onclick="this.closest('tr').remove()">❌</button></td>
      `;

      document.querySelector("#menuTable tbody").appendChild(row);
    }

    async function loadMenus() {
      const res = await fetch(`${apiBase}?action=getMenus`);
      const menus = await res.json();
      menus.forEach(menu => createRow(menu));
    }

    function addRow() {
      createRow();
    }

    async function saveMenus() {
      const rows = document.querySelectorAll("#menuTable tbody tr");
      const menus = [];

      for (let row of rows) {
        const cells = row.querySelectorAll("td");
        const id = cells[0].querySelector("input").value.trim();
        const name = cells[1].querySelector("input").value.trim();
        const price = parseInt(cells[2].querySelector("input").value.trim() || "0");
        const active = cells[3].querySelector("input").checked;

        if (!id || !name) continue;

        menus.push({ id, name, price, active });
      }

      const res = await fetch(`${apiBase}?action=saveMenus`, {
        method: "POST",
        body: JSON.stringify(menus)
      });

      const text = await res.text();
      document.getElementById("result").innerText = (text === "OK") ? "✅ 저장 완료!" : `에러: ${text}`;
    }

    loadMenus();
  </script>
</body>
</html>
